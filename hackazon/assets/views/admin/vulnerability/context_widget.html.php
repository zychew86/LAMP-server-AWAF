<?php
$formHelper = $view['form'];
$formHelper->setTheme($form, __DIR__);
/** @var \Symfony\Component\Form\FormView $form */
?>
<div class="panel panel-primary context-panel js-context-panel" <?php echo $view['form']->block($form, 'widget_container_attributes') ?>
    data-id="<?php echo $form->vars['id']; ?>" data-name="<?php echo $form->vars['full_name']; ?>">
    <div class="panel-heading form-inline">
        <?php if (!$form->vars['edit_mode_enabled']): ?>
            <?php echo '<strong>' . $form['name']->vars['value'] . '</strong> (' . $form['type']->vars['value'] . ')'; ?>
        <?php endif; ?>
        <?php echo isset($form['name']) ? $formHelper->widget($form['name']) : ''; ?>
        <?php echo isset($form['storageRole']) ? $formHelper->widget($form['storageRole']) : ''; ?>
        <?php echo isset($form['type']) ? $formHelper->widget($form['type']) : ''; ?>

        <?php if ($form->vars['edit_mode_enabled']): ?>
        <div class="pull-right">
            <div class="btn-group">
                <button class="btn btn-default js-add-field" type="button">Add Field</button>
                <button class="btn btn-default js-add-child-context" type="button">Add Child</button>
                <button class="btn btn-default js-remove" type="button">Remove</button>
            </div>
        </div>
        <?php endif; ?>
    </div>
    <!-- /.panel-heading -->
    <div class="panel-body">
        <?php echo $formHelper->errors($form); ?>
        <?php echo $formHelper->row($form['fields']); ?>

        <a href="#" class="js-show-vulns-link show-vulns-link">Show vulnerabilities</a><br>
        <div class="vulns-block js-vulns-block">
            <?php echo $formHelper->row($form['vulnTree']); ?>
        </div>

        <?php if ($form['children'] && $form['children']->count()): ?><br><?php endif; ?>
        <?php //echo $view['form']->block($form, 'form_rows') ?>
        <?php foreach ($form as $child) : ?>
            <?php echo $view['form']->row($child) ?>
        <?php endforeach; ?>

        <?php //echo $formHelper->rest($form); ?>
        <?php foreach ($form as $child): ?>
            <?php if (!$child->isRendered()): ?>
                <?php echo $view['form']->row($child) ?>
            <?php endif; ?>
        <?php endforeach; ?>
    </div>
</div>